if (self.CavalryLogger) { CavalryLogger.start_js(["yoGvS"]); }

__d("oz-player/streams/OzPredictedSegmentLocator",["oz-player/streams/OzSegmentLocator","oz-player/utils/OzNumericalRangeUtil"],(function(a,b,c,d,e,f){"use strict";var g=.05;a=function(){function a(){this.$1=!1,this.$3={}}var c=a.prototype;c.getSegment=function(a,b,c,d,e,f,g,h,i){var j;this.$3[i]==null&&(this.$3[i]={lastPausedDownloadingTime:0,lastCurrentTime:0});this.$1!=b.isPlaying()&&(b.isPlaying()&&(this.$2=Date.now()),this.$1=b.isPlaying());if(g.getBool("pdash_download_cursor_pause_duration_of_gop")&&this.$3[i]&&this.$3[i].lastPausedDownloadingTime!=null&&this.$3[i].lastPausedDownloadingTime+((j=a.getMaxGopSec())!=null?j:0)>Date.now())return null;j=g.getNumber("catchup_timeout_after_play_sec")===0||Date.now()-((j=this.$2)!=null?j:0)<g.getNumber("catchup_timeout_after_play_sec")*1e3;a=this.$4(a,b,c,d,e,f,g,h&&j,i);this.$3[i].lastCurrentTime=b.getCurrentTime();return a};c.$4=function(a,c,d,e,f,h,i,j,k){var l,m,n,o=c.getCurrentTime();c=i.getNumber("pdash_download_cursor_catchup_threshold_sec")>0;l=c?Math.max(i.getNumber("pdash_download_cursor_catchup_threshold_sec"),(l=a.getMaxGopSec())!=null?l:0*i.getNumber("pdash_download_cursor_catchup_threshold_gop_multiplier")):0;m=c?Math.max(i.getNumber("pdash_download_cursor_catchup_tolerance_sec"),(m=a.getMaxGopSec())!=null?m:0*i.getNumber("pdash_download_cursor_tolerance_gop_multiplier")):0;n=c?Math.max(d,l+((n=a.getMaxGopSec())!=null?n:0)*i.getNumber("pdash_download_cursor_bufferahead_gop_multiplier")):d;d=e==null?void 0:e.getBufferedRanges();e=d?new(b("oz-player/utils/OzNumericalRangeUtil"))().findCurrentRangeIndex(o,d.map(function(a){return{rangeStart:a.startTime,rangeEnd:a.endTime}})):-1;var p=e>=0&&d!=null?d[e].endTime-o:0;d=d!=null?d.slice(e).reduce(function(a,b){if(b.startTime<o)return a+(b.endTime-o);else return a+(b.endTime-b.startTime)},0):0;if(p>n)return null;e=a.getPredictedSegmentAfter(f);n=a.getEndingSegment();f=n!=null?n==null?void 0:n.getTimeRange().endTime:null;n=f!=null&&c?f-l:null;c=!i.getBool("pdash_download_cursor_catchup_only_when_advancing")||i.getBool("pdash_download_cursor_catchup_only_when_advancing")&&this.$3[k]&&this.$3[k].lastCurrentTime!=null&&this.$3[k].lastCurrentTime+g<o;if(j&&e!=null&&n!=null&&f!=null&&c&&o<n-m){if(i.getBool("pdash_download_cursor_catchup_skip_totalbufer")&&d>l){this.$3[k].lastPausedDownloadingTime=Date.now();return null}j=a.getSegmentByTime(f-Math.max(0,l-p));((c=j==null?void 0:j.getSequenceNumber())!=null?c:0)>((n=e.getSequenceNumber())!=null?n:0)&&(e=j)}else e==null&&(e=a.getSegmentByTime(o));m=h&&h.getSequenceNumber()||0;i=e&&e.getSequenceNumber()||0;if(e&&h&&m>=i){d=b("oz-player/streams/OzSegmentLocator").getEndingSequenceNumber(a);return(d||0)>=m?h:null}return e};return a}();f.OzPredictedSegmentLocator=a}),null);